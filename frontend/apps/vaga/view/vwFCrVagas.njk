{% extends "templates/base.html" %}

{% block content %}
  <div x-data="vagasForm()">
    <ol class="breadcrumb mb-2">
      <li class="breadcrumb-item active">{{ title }}</li>
    </ol>
    <div class="card-body">
      <div class="">
        <form>
          <div class="form-group col-md-12">
            <label for="descricao">Descrição</label>
            <input type="text" class="form-control" id="descricao" x-model="form.descricao"></div>
            <div class="form-group col-md-12">              
              <button type="button" @click="insertForm()" class="btn btn-primary mt-4">Salvar</button>
              <a href="/vagas/ManutVagas" class="btn btn-info mt-4 ml-2" role="button">Retornar</a>
            </form>
            <div class="mt-3">
              <template x-if="message">
                <div :class="messageClass" x-text="message"></div>
              </template>
            </div>
          </div>
        </div>
      </div>
      <script>
        function vagasForm() {
          return {
            form: {
              descricao: ''
            },
            message: '',
            messageClass: '',
            async insertForm() {
              try {
                console.log("Valor na página:", JSON.stringify(this.form))
                const response = await fetch('/vagas/InsertVagas', {
                  method: 'POST',
                  headers: {
                    "Content-Type": "application/json"
                  },
                  body: JSON.stringify(this.form)
                });
                const result = await response.json();
                console.log("Valor na response:", response);
                console.log("Valor na result:", result);
                if (result.status == "ok") {
                  alert("Vaga cadastrada com suscesso");
                  this.resetForm();
                } else {
                  const errorData = result.status;
                  this.message = `Erro! Não foi possível cadastrar a Vaga devido ao erro: ${errorData}`;
                  this.messageClass = 'alert alert-danger';
                }
              } catch (error) {
                this.message = `Erro de conexão: ${
                  error.message
                }`;
                this.messageClass = 'alert alert-danger';
              }
            },
            resetForm() {
              this.form = {
              descricao: ''
              };
              this.message = false;
            }
          };
        }
      </script>
      
    {% endblock %}
